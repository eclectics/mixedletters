<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" content="user-scalable=no">
        <link rel="apple-touch-icon" href="apple-touch-icon.png"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="white" />
        <script language="javascript">
    //simple letter matching game
    //options:different fonts, cases, number of letters
    //drag letters onto each other-- if they're the same top one gets eaten, bottom one stays the same, glows green.
    //records errors as sets of two letters, order not important pq==qp, keep table of errors for session for review.
    var counts={};
    var cur={node:null,x:0,y:0}; //current node;
var letters=(function(){
    var fonts=["Verdana"];
    var allLetters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"; 
    var lettersAvailable=localStorage.lettersAvailable || allLetters;
    var options={letters:["lower"],
                number:50,
                selection:26,
                fonts:{"Baskerville":1,"AmericanTypewriter":1,"ChalkboardSE-Regular":1,"Cochin-Italic":1,"Avenir-Black":1,"Verdana":1,"Courier":1,"Georgia":1,"TimesNewRomanPSMT":1,"Futura-Medium":1,"HelveticaNeue":1,"MarkerFelt-Thin":1,"Papyrus":1}
            };
    var main;
    function pd(e){
        e.preventDefault();
    }

    function init(){
        document.addEventListener("gesturechange",pd);
        document.addEventListener("gesturestart",pd);
        document.addEventListener("touchmove",pd);
        document.addEventListener("dragover",pd);
        main=document.getElementById("main");
        document.getElementById("btnsettings").style.display="block";
        document.getElementById("btnplay").style.display="none";
        document.getElementById("main").style.display="block";
        document.getElementById("settings").style.display="none";
        //note can add event listener to functions cause init has access to them? but init doesn't have access to the object by name? argh no-- I was shadowing it!!
        document.getElementById("btnsettings").addEventListener("click",settings);
        document.getElementById("btnplay").addEventListener("click",play,false);
        var html='';
        for (var i=0;i<allLetters.length;i++){
            html+='<div class="filter" id="'+allLetters[i]+'">'+allLetters[i]+'</div>';  
        }
        html+='<div>Letters:<input type="text" pattern="[0-9]*" id="txtNum"/></div>';
        document.getElementById("settings").innerHTML=html;
        for(i=0;i<allLetters.length;i++){
            if (lettersAvailable.indexOf(allLetters[i])!=-1){
                document.getElementById(allLetters[i]).style.backgroundColor="rgb(255, 255, 255)";
            } else {
                document.getElementById(allLetters[i]).style.backgroundColor="rgb(128, 128, 128)";
            }
        }
        document.getElementById("settings").addEventListener("click",function(e){hideLetter(e);});
        document.getElementById("main").addEventListener("touchstart",function(e){liftLetter(e);});
        document.getElementById("main").addEventListener("touchmove",move);
        document.getElementById("main").addEventListener("touchend",dropLetter);
        document.getElementById("main").addEventListener("mouseup",ckLetter);
        initgame();
    }
    function hideLetter(e){
        var l;
        if (e.target && allLetters.indexOf(e.target.id)!=-1){
            l= document.getElementById(e.target.id);
            if (l.style.backgroundColor=="rgb(128, 128, 128)"){
                l.style.backgroundColor="rgb(255, 255, 255)";
                lettersAvailable=lettersAvailable+e.target.id; //order irrelevant
            } else {
                l.style.backgroundColor="rgb(128, 128, 128)";
                lettersAvailable=lettersAvailable.replace(e.target.id,'');
            }
        }
    }
    function ckLetter(e){
        console.log(e);
    }
    function removeLetter(e){
        //remove event listener
        //use in the addlistener      this.removeEventListener('click', arguments.callee);
        //css3 transitions
        counts[e.textContent]--;
        e.style.background="-webkit-linear-gradient(white, red)";
        e.style.opacity=0;
        e.style.webkitTransitionProperty="opacity, -webkit-transform";
        e.style.webkitTransitionDuration="1s,1s";
        e.style.webkitTransform+=' rotate(270deg) scale(0.5,0.5)';
        //was going to remove letters, but it makes it harder to play
    }
    function initgame(){
        //clear
        counts={};
        document.getElementById("main").innerHTML="";
        for (var i=0;i<options.number;i++){
            addLetter(i);
        }
    }
    function checkDone(){
        for(var l in counts){
            if (counts[l]) return false;
        }
        return true;
    }
    function toggle(ar){
        var i,elt;
        for(i=0;i<ar.length;i++){
            elt=document.getElementById(ar[i]);
            if (elt.style.display=="block"){
                elt.style.display="none";
            } else {
                elt.style.display="block";
            }
        }
    }
     function settings(){
        toggle(["settings","btnplay","main","btnsettings"]);
       
    }
    function play(){
        localStorage.lettersAvailable=lettersAvailable;
        initgame();
        toggle(["settings","btnplay","main","btnsettings"]);
    }
    function addLetter(i){
        //adds a letter to the field
        var letter=lettersAvailable[parseInt(Math.random()*Math.min(options.selection,lettersAvailable.length))];
        main.innerHTML+='<div class="letter" id="l'+i+'" onclick="void(0);">'+letter+'</div> ';
        document.getElementById('l'+i).style.fontFamily=fonts[parseInt(Math.random()*fonts.length)];
        if (! ++counts[letter]){counts[letter]=0;}
                
    }
    function d(){
        return lettersAvailable;
    }

    function liftLetter(evt){
        //on mousedown or touch
        if (evt.target && evt.target.id!="main"){
            cur.node=document.getElementById(evt.target.id);
            cur.node.style.zIndex="10";
            cur.x=cur.node.offsetLeft;
            cur.y=cur.node.offsetTop;
            cur.node.style.pointerEvents="none";
        }

    }
    function move(evt){
        evt.preventDefault();
        if (evt.target && evt.target.id!="main"){
            curX = evt.targetTouches[0].pageX-evt.target.offsetLeft-25;
            curY = evt.targetTouches[0].pageY-evt.target.offsetTop-25;
            evt.targetTouches[0].target.style.webkitTransform =
            'translate(' + curX + 'px, ' + curY + 'px)';
        }
    }
    function dropLetter(e){
        //on mouseup or release
        //check target
        var t=e.changedTouches[0];
        var target=document.elementFromPoint(t.pageX,t.pageY); 
        //console.log(target);
        if (target.textContent==cur.node.textContent){
            removeLetter(cur.node);
            if (checkDone()){
                alert('Done!');
            }
            } else {
                cur.node.style.pointerEvents="auto";
                cur.node.style.webkitTransform='translate(0px, 0px)';
                cur.node.style.zIndex="5";
                cur.node=null;
            }

    }

    return {init:init,
        settings:settings,
        play:play,
        toggle:toggle,
        removeLetter:removeLetter,
        d:d
       };
   })();
   document.addEventListener("DOMContentLoaded",letters.init);
</script>
<style>
    body {-webkit-text-size-adjust:200%;
    }
div.filter { border: 1px solid grey;
            margin:0.5ex;
            float:left;
            padding:0.5ex 1ex;
            font-family:Courier;
        }

div.letter {border: 1px solid grey;
            margin:0.5ex;
            float:left;
            border-radius:20px;
            padding:0.5ex 1ex;
            font-family:Courier;
            -webkit-tap-highlight-color:#F00;
            background: -webkit-linear-gradient(white, aqua);
            z-index:5;
        }
div.button {border-radius:12px;
        border:1px solid grey;
        padding:.5ex;
        font-size:60%;
        margin: 0ex auto;
        width:30%;
        text-align:center;
        font-family:Verdana;
    } 
</style>
</head>
<body>
    <div id="controls">
        <div class="button" id="btnsettings">Settings</div>
        <div class="button" id="btnplay">Play</div>
    </div>
    <div id="settings">Settings</div>
    <div id="main">
    </div>
</body>
</html>

